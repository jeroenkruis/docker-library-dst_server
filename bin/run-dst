#!/bin/bash
# Update game on startup
/home/steam/steamcmd/steamcmd.sh +login anonymous +force_install_dir /home/steam/steamapps/DST +app_update 343050 validate +quit

ln -sf /DST /home/steam/.klei/DoNotStarveTogether
if [[ ! -z "$SERVER_TOKEN" ]]; then
	echo -ne "$SERVER_TOKEN" | grep -P -n '\0$' > /dev/null
	if [ $? -ne 0 ]; then
		echo "Appendix for token..."
		SERVER_TOKEN="$SERVER_TOKEN\0"
	fi
	echo -ne "$SERVER_TOKEN" > /DST/server_token.txt
fi

## declare mods
declare -a arr=("378160973" "369588618" "374550642" "396026892")

for i in "${arr[@]}"
do
	echo "ServerModSetup(\""$i"\")" >> ~/steamapps/DST/mods/dedicated_server_mods_setup.lua
done

## enable mods
for i in "${arr[@]}"
do
	echo "ForceEnableMod(\"workshop-"$i"\")" >> ~/steamapps/DST/mods/modsettings.lua
done

cd ~/steamapps/DST/data
../bin/dontstarve_dedicated_server_nullrenderer $@
